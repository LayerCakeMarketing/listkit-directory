# Model Context Protocol (MCP) Setup Guide

This guide explains how to set up and use MCP servers with Claude's Code CLI to enhance development efficiency for the Listerino/ListKit project.

## What is MCP?

Model Context Protocol (MCP) allows Claude to integrate with external tools and services, providing:
- Version-specific documentation (Context7)
- UI component generation (MagicUI)
- Automated testing capabilities (Playwright)

## MCP Servers Configuration

### 1. Project Configuration File

The MCP configuration is stored in `.vscode/mcp.json`:

```json
{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["@context7/mcp-server"],
      "env": {
        "CONTEXT7_API_URL": "https://mcp.context7.com/mcp"
      },
      "transport": "http",
      "description": "Provides version-specific documentation for Laravel 11, Vue 3, and PostgreSQL"
    },
    "magicui": {
      "command": "npx",
      "args": ["@21st-dev/magic@latest"],
      "transport": "stdio",
      "description": "Generates Vue 3 components with Tailwind CSS for UI development"
    },
    "playwright": {
      "command": "npx",
      "args": ["@playwright/mcp@latest"],
      "transport": "stdio",
      "description": "Automated testing for user flows using Playwright",
      "enabled": false
    }
  },
  "projectContext": {
    "framework": "laravel",
    "version": "11",
    "frontend": "vue3",
    "css": "tailwind",
    "database": "postgresql",
    "features": [
      "spa",
      "sanctum-auth",
      "business-claiming",
      "polymorphic-lists"
    ]
  }
}
```

### 2. Claude Desktop Configuration

Add to your Claude Desktop settings (usually `~/Library/Application Support/Claude/claude_desktop_config.json` on macOS):

```json
{
  "mcpServers": {
    "context7": {
      "command": "npx",
      "args": ["@context7/mcp-server"],
      "env": {
        "CONTEXT7_API_URL": "https://mcp.context7.com/mcp"
      }
    },
    "magicui": {
      "command": "npx",
      "args": ["@21st-dev/magic@latest"]
    }
  }
}
```

### 3. Installing MCP Servers via Claude CLI

```bash
# Context7 - Laravel/Vue/PostgreSQL documentation
claude mcp add --transport http -s user context7

# MagicUI - Vue component generation
claude mcp add -s user magic npx @21st-dev/magic@latest

# Playwright - Automated testing (optional)
claude mcp add -s user playwright npx @playwright/mcp@latest
```

## Using MCP Servers

### Context7 MCP Usage

Context7 provides accurate, version-specific documentation:

**Example: Fixing SQL Errors**
```
Claude: Use Context7 to find the correct Laravel 11 migration syntax for foreign keys

Context7 will provide:
- Correct foreign key constraint syntax
- Index recommendations
- PostgreSQL-specific optimizations
```

**Example: Eloquent Queries**
```
Claude: Check Context7 for Laravel 11 polymorphic relationship best practices

Context7 will provide:
- Proper morphTo/morphMany setup
- Eager loading strategies
- Query optimization tips
```

### MagicUI MCP Usage

MagicUI generates Vue 3 components with Tailwind CSS:

**Example: Generate Claim Modal**
```
Claude: Use MagicUI to create a multi-step modal for business claiming with:
- Step indicator
- Form validation
- OTP input component
- Document upload area
```

**Example: Generate List Component**
```
Claude: Use MagicUI to create a draggable list component with:
- Drag and drop reordering
- Add/remove items
- Rich text descriptions
- Image uploads
```

### Playwright MCP Usage (Optional)

For automated testing of user flows:

**Example: Test Claiming Process**
```javascript
// Generated by Playwright MCP
test('business claiming flow', async ({ page }) => {
  await page.goto('http://localhost:5173/places/test-business')
  await page.click('text=Claim This Business')
  await page.click('text=Email Verification')
  await page.fill('input[type="email"]', 'test@business.com')
  await page.click('text=Continue')
  await page.fill('input[name="otp"]', '123456')
  await page.click('text=Verify')
  expect(await page.textContent('.claim-status')).toBe('Claim Pending')
})
```

## MCP Benefits for This Project

### 1. Accurate Code Generation
- Context7 ensures Laravel 11 syntax (not Laravel 8/9)
- Vue 3 Composition API (not Options API)
- PostgreSQL 15+ features

### 2. Faster UI Development
- MagicUI generates complete Vue components
- Tailwind classes are properly applied
- Components follow project patterns

### 3. Reduced Errors
- Version-specific documentation prevents outdated code
- Type-safe component generation
- Automated testing catches regressions

## Performance Considerations

### MCP Server Overhead
- Context7: ~50-100ms per query (HTTP)
- MagicUI: ~200-300ms generation time
- Playwright: ~1-2s test startup

### Optimization Tips
1. **Batch Requests**: Ask for multiple components at once
2. **Cache Results**: Store generated components for reuse
3. **Selective Usage**: Only enable MCP when needed
4. **Local Mode**: Run MCP servers locally for faster response

## Troubleshooting

### Common Issues

**MCP Not Responding**
```bash
# Check if MCP server is running
ps aux | grep mcp

# Restart Claude Desktop
# Reinstall MCP server
npm install -g @context7/mcp-server
```

**Version Mismatch**
```bash
# Ensure correct versions in mcp.json
"projectContext": {
  "framework": "laravel",
  "version": "11",  # Not "10" or "12"
  "frontend": "vue3",  # Not "vue2"
}
```

**Docker Environment**
```bash
# MCP works with local development
# Ensure servers connect to correct ports:
- Laravel: http://localhost:8000
- Frontend: http://localhost:5173
- PostgreSQL: localhost:5432
```

## Security Considerations

1. **API Keys**: Store in environment variables
2. **Local Only**: MCP servers run locally
3. **No Production**: Don't deploy MCP configs
4. **Code Review**: Always review generated code

## Best Practices

### 1. Project Context
Always provide context when using MCP:
```
"Using Laravel 11, Vue 3, PostgreSQL 15, generate a component for..."
```

### 2. Incremental Generation
Generate components incrementally:
1. Basic structure first
2. Add functionality
3. Apply styling
4. Add tests

### 3. Pattern Matching
Ensure generated code matches existing patterns:
- Check existing components
- Follow naming conventions
- Use project utilities

## Future Enhancements

### Planned MCP Integrations
1. **Database MCP**: Direct PostgreSQL schema queries
2. **Testing MCP**: Jest/Vitest test generation
3. **Documentation MCP**: Auto-generate API docs
4. **Security MCP**: Vulnerability scanning

### Custom MCP Servers
Consider creating project-specific MCP servers:
- Business claiming workflow assistant
- List management helper
- Region hierarchy navigator

## Summary

MCP servers enhance Claude's ability to:
1. Provide accurate, version-specific code
2. Generate UI components quickly
3. Automate testing workflows
4. Reduce development errors

By integrating Context7, MagicUI, and optionally Playwright, development becomes faster and more reliable, especially for complex features like business claiming and list management.